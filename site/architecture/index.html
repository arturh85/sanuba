
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../cppn-neat/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="zensical-0.0.15">
    
    
      
        <title>Architecture: System Design - Sunaba 砂場（すなば）</title>
      
    
    
      
        
      
      <link rel="stylesheet" href="../assets/stylesheets/modern/main.f1b6466b.min.css">
      
      
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  
  <style>:root{}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,500,500i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0),__md_get=(e,t=localStorage,a=__md_scope)=>JSON.parse(t.getItem(a.pathname+"."+e)),__md_set=(e,t,a=localStorage,_=__md_scope)=>{try{a.setItem(_.pathname+"."+e,JSON.stringify(t))}catch(e){}},document.documentElement.setAttribute("data-platform",navigator.platform)</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architecture-system-design" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Sunaba 砂場（すなば）" class="md-header__button md-logo" aria-label="Sunaba 砂場（すなば）" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-book-open" viewBox="0 0 24 24"><path d="M12 7v14M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-menu" viewBox="0 0 24 24"><path d="M4 5h16M4 12h16M4 19h16"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sunaba 砂場（すなば）
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture: System Design
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-search" viewBox="0 0 24 24"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog" aria-label="Search">
  <button type="button" class="md-search__button">
    Search
  </button>
</div>
      
    
    <div class="md-header__source">
      
    </div>
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Sunaba 砂場（すなば）" class="md-nav__button md-logo" aria-label="Sunaba 砂場（すなば）" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-book-open" viewBox="0 0 24 24"><path d="M12 7v14M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>

    </a>
    Sunaba 砂場（すなば）
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sunaba: Emergent Artificial Life
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Architecture: System Design
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture: System Design
  

    
  </span>
  
  

      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#high-level-system-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        High-Level System Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation-layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simulation Layers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulation Layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layer-interaction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer Interaction
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#world-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        World Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="World Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chunk-organization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunk Organization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunk-data-layout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunk Data Layout
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evolution-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evolution Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evolution Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#offline-training-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Offline Training Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cppn-morphology-generation" class="md-nav__link">
    <span class="md-ellipsis">
      
        CPPN Morphology Generation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creature-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creature Lifecycle
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#neural-control-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Neural Control Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Neural Control Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#per-frame-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Per-Frame Processing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensor-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sensor Details
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Training Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Training Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fitness-computation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fitness Computation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#map-elites-archive" class="md-nav__link">
    <span class="md-ellipsis">
      
        MAP-Elites Archive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MAP-Elites Archive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#archive-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Archive Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archive-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Archive Operations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flow Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Interface
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inventory-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inventory System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crafting-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Crafting System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#material-showcase" class="md-nav__link">
    <span class="md-ellipsis">
      
        Material Showcase
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lighting-world-systems" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lighting &amp; World Systems
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structural-complexity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Structural Complexity
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tech-stack-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tech Stack Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cppn-neat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CPPN-NEAT: Procedural Morphology Generation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../emergent-physics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Emergent Physics: Cellular Automata Foundations
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../map-elites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MAP-Elites: Quality-Diversity Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../neural-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Control: Brain Architectures for Embodied Agents
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../prior-work/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prior Work: Literature Review and Inspirations
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#high-level-system-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        High-Level System Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation-layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simulation Layers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulation Layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layer-interaction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer Interaction
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#world-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        World Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="World Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chunk-organization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunk Organization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunk-data-layout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunk Data Layout
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evolution-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evolution Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evolution Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#offline-training-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Offline Training Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cppn-morphology-generation" class="md-nav__link">
    <span class="md-ellipsis">
      
        CPPN Morphology Generation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creature-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creature Lifecycle
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#neural-control-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Neural Control Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Neural Control Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#per-frame-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Per-Frame Processing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sensor-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sensor Details
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Training Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Training Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fitness-computation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fitness Computation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#map-elites-archive" class="md-nav__link">
    <span class="md-ellipsis">
      
        MAP-Elites Archive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MAP-Elites Archive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#archive-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Archive Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#archive-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Archive Operations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flow Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Interface
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inventory-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inventory System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crafting-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Crafting System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#material-showcase" class="md-nav__link">
    <span class="md-ellipsis">
      
        Material Showcase
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lighting-world-systems" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lighting &amp; World Systems
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structural-complexity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Structural Complexity
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tech-stack-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tech Stack Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  

<h1 id="architecture-system-design">Architecture: System Design<a class="headerlink" href="#architecture-system-design" title="Permanent link">&para;</a></h1>
<p>This page provides technical diagrams showing how Sunaba's systems fit together. For code-level details, see the repository's CLAUDE.md file.</p>
<h2 id="high-level-system-overview">High-Level System Overview<a class="headerlink" href="#high-level-system-overview" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>flowchart TB
    subgraph "Game Layer"
        UI[User Interface]
        R[Renderer]
        Input[Input Handler]
    end

    subgraph "Simulation Core"
        W[World Manager]
        CA[Cellular Automata Engine]
        T[Temperature System]
        S[Structural Integrity]
        P[Physics Engine]
    end

    subgraph "Creature System"
        C[Creature Manager]
        B[Brain/Neural Controller]
        G[GOAP Planner]
        Sensors[Sensor System]
    end

    subgraph "Evolution Pipeline"
        ME[MAP-Elites Archive]
        CPPN[CPPN-NEAT Generator]
        Eval[Fitness Evaluation]
    end

    Input --&gt; W
    W --&gt; CA
    W --&gt; T
    W --&gt; S
    W --&gt; P
    CA --&gt; R
    P --&gt; C
    Sensors --&gt; B
    B --&gt; C
    C --&gt; W
    CPPN --&gt; C
    Eval --&gt; ME
    ME --&gt; CPPN</code></pre>
<h2 id="simulation-layers">Simulation Layers<a class="headerlink" href="#simulation-layers" title="Permanent link">&para;</a></h2>
<p>The world simulation operates in layers with different update frequencies:</p>
<pre class="mermaid"><code>flowchart TD
    subgraph "60 FPS"
        CA[Cellular Automata]
        Physics[Rigid Body Physics]
        Neural[Neural Inference]
    end

    subgraph "30 FPS"
        Temp[Temperature Diffusion]
        GOAP[GOAP Planning]
    end

    subgraph "Event-Driven"
        Struct[Structural Integrity]
        React[Chemical Reactions]
    end

    CA --&gt; Temp
    CA --&gt; Struct
    Physics --&gt; Neural
    Neural --&gt; GOAP</code></pre>
<h3 id="layer-interaction">Layer Interaction<a class="headerlink" href="#layer-interaction" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant CA as Cellular Automata
    participant Temp as Temperature
    participant Struct as Structural
    participant Phys as Physics

    loop Every Frame
        CA-&gt;&gt;CA: Update pixel positions
        CA-&gt;&gt;Temp: Report heat sources
        Temp-&gt;&gt;Temp: Diffuse heat (every 2nd frame)
        Temp-&gt;&gt;CA: Trigger state changes
        CA-&gt;&gt;Struct: Report removals
        Struct-&gt;&gt;Phys: Create debris bodies
        Phys-&gt;&gt;CA: Update body positions
    end</code></pre>
<h2 id="world-structure">World Structure<a class="headerlink" href="#world-structure" title="Permanent link">&para;</a></h2>
<h3 id="chunk-organization">Chunk Organization<a class="headerlink" href="#chunk-organization" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart LR
    subgraph "World"
        direction TB
        subgraph "Active Chunks"
            A1[Chunk 0,0]
            A2[Chunk 1,0]
            A3[Chunk 0,1]
            A4[Chunk 1,1]
        end

        subgraph "Loaded Chunks"
            L1[Chunk -1,0]
            L2[Chunk 2,0]
        end

        subgraph "Disk"
            D1[Serialized chunks...]
        end
    end

    A1 &lt;--&gt; A2
    A2 &lt;--&gt; A4
    A1 &lt;--&gt; A3
    A3 &lt;--&gt; A4
    L1 &lt;--&gt; A1
    L2 &lt;--&gt; A2
    D1 -.-&gt; L1
    D1 -.-&gt; L2</code></pre>
<h3 id="chunk-data-layout">Chunk Data Layout<a class="headerlink" href="#chunk-data-layout" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Chunk (64×64 pixels)
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>├── pixel_data: [u32; 4096]
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>│   ├── bits 0-15:  material_id
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>│   ├── bits 16-23: flags
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>│   └── bits 24-31: variant/metadata
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>├── temperature: [f32; 64]  (8×8 coarse grid)
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>├── light: [u8; 4096]
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>└── dirty_rect: Option&lt;Rect&gt;
</span></code></pre></div>
<h2 id="evolution-pipeline">Evolution Pipeline<a class="headerlink" href="#evolution-pipeline" title="Permanent link">&para;</a></h2>
<h3 id="offline-training-flow">Offline Training Flow<a class="headerlink" href="#offline-training-flow" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart TD
    subgraph "Initialization"
        I1[Create random CPPN genomes]
        I2[Initialize MAP-Elites archive]
    end

    subgraph "Evolution Loop"
        S1[Select from archive]
        S2[Mutate genome]
        S3[Build morphology from CPPN]
        S4[Initialize neural controller]
        S5[Run evaluation scenario]
        S6[Compute fitness + behavior]
        S7[Update archive]
    end

    I1 --&gt; I2
    I2 --&gt; S1
    S1 --&gt; S2
    S2 --&gt; S3
    S3 --&gt; S4
    S4 --&gt; S5
    S5 --&gt; S6
    S6 --&gt; S7
    S7 --&gt; S1</code></pre>
<h3 id="cppn-morphology-generation">CPPN Morphology Generation<a class="headerlink" href="#cppn-morphology-generation" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart TD
    subgraph "CPPN Query"
        Q1[Define bounding box]
        Q2[Generate query points]
        Q3[For each point x,y,d]
        Q4[Feed into CPPN network]
        Q5[Get outputs]
    end

    subgraph "Body Construction"
        B1{presence &gt; threshold?}
        B2[Create segment]
        B3[Assign to body graph]
        B4[Determine joint type]
        B5[Connect to neighbors]
    end

    Q1 --&gt; Q2 --&gt; Q3 --&gt; Q4 --&gt; Q5
    Q5 --&gt; B1
    B1 --&gt;|Yes| B2
    B2 --&gt; B3 --&gt; B4 --&gt; B5
    B1 --&gt;|No| Q3
    B5 --&gt; Q3</code></pre>
<h2 id="creature-lifecycle">Creature Lifecycle<a class="headerlink" href="#creature-lifecycle" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>stateDiagram-v2
    [*] --&gt; Spawning: CPPN generates body

    Spawning --&gt; Active: Body valid

    state Active {
        [*] --&gt; Sensing
        Sensing --&gt; Thinking: Sensor data collected
        Thinking --&gt; Acting: Motor commands generated
        Acting --&gt; Sensing: Physics stepped
    }

    Active --&gt; Dead: Health &lt;= 0
    Active --&gt; Dead: Fall out of world
    Active --&gt; Reproducing: Fitness threshold

    Reproducing --&gt; Active: Offspring spawned

    Dead --&gt; [*]: Despawn</code></pre>
<h2 id="neural-control-pipeline">Neural Control Pipeline<a class="headerlink" href="#neural-control-pipeline" title="Permanent link">&para;</a></h2>
<h3 id="per-frame-processing">Per-Frame Processing<a class="headerlink" href="#per-frame-processing" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart LR
    subgraph "Sensors"
        P[Proprioception]
        E[Exteroception]
        I[Internal State]
    end

    subgraph "Encoding"
        PE[Prop Encoder]
        EE[Ext Encoder]
        IE[State Encoder]
    end

    subgraph "Brain"
        H1[Hidden 64]
        H2[Hidden 64]
        H3[Hidden 32]
        O[Output]
    end

    subgraph "Motors"
        M1[Joint 1]
        M2[Joint 2]
        M3[Joint N]
    end

    P --&gt; PE --&gt; H1
    E --&gt; EE --&gt; H1
    I --&gt; IE --&gt; H1
    H1 --&gt; H2 --&gt; H3 --&gt; O
    O --&gt; M1
    O --&gt; M2
    O --&gt; M3</code></pre>
<h3 id="sensor-details">Sensor Details<a class="headerlink" href="#sensor-details" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart TD
    subgraph "Proprioception per Joint"
        J1[angle: -π to π]
        J2[velocity: normalized]
        J3[torque: normalized]
        J4[contact: 0 or 1]
    end

    subgraph "Exteroception"
        R1[8 raycasts × 3 values]
        R2[distance, material, temperature]
    end

    subgraph "Internal State"
        S1[health: 0 to 1]
        S2[hunger: 0 to 1]
        S3[orientation: sin, cos]
    end</code></pre>
<h2 id="training-scenarios">Training Scenarios<a class="headerlink" href="#training-scenarios" title="Permanent link">&para;</a></h2>
<h3 id="scenario-types">Scenario Types<a class="headerlink" href="#scenario-types" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart LR
    subgraph "Locomotion"
        L1[Flat terrain]
        L2[Target point reward]
        L3[Time limit: 30s]
    end

    subgraph "Foraging"
        F1[Scattered food]
        F2[Consumption reward]
        F3[Time limit: 60s]
    end

    subgraph "Survival"
        S1[Hazards present]
        S2[Food + threats]
        S3[Time limit: 120s]
    end

    subgraph "Combat"
        C1[Opponent creature]
        C2[Damage dealt reward]
        C3[Time limit: 60s]
    end</code></pre>
<h3 id="fitness-computation">Fitness Computation<a class="headerlink" href="#fitness-computation" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart TD
    subgraph "Raw Metrics"
        M1[distance_traveled]
        M2[food_eaten]
        M3[time_survived]
        M4[damage_dealt]
        M5[offspring_produced]
    end

    subgraph "Weights"
        W1[scenario-specific weights]
    end

    subgraph "Final Fitness"
        F[weighted sum]
    end

    M1 --&gt; W1
    M2 --&gt; W1
    M3 --&gt; W1
    M4 --&gt; W1
    M5 --&gt; W1
    W1 --&gt; F</code></pre>
<h2 id="map-elites-archive">MAP-Elites Archive<a class="headerlink" href="#map-elites-archive" title="Permanent link">&para;</a></h2>
<h3 id="archive-structure">Archive Structure<a class="headerlink" href="#archive-structure" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart TD
    subgraph "2D Behavior Space"
        direction LR
        subgraph "Axis 1: Ground Contact"
            X1[0.0]
            X2[0.25]
            X3[0.5]
            X4[0.75]
            X5[1.0]
        end
    end

    subgraph "Archive Grid"
        G[20 × 20 cells]
        E[Each cell: elite genome + fitness]
    end

    X1 --&gt; G
    X5 --&gt; G</code></pre>
<h3 id="archive-operations">Archive Operations<a class="headerlink" href="#archive-operations" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant E as Evaluator
    participant A as Archive
    participant S as Selector

    E-&gt;&gt;E: Evaluate creature
    E-&gt;&gt;E: Compute behavior descriptor
    E-&gt;&gt;A: Check cell for behavior
    alt Cell empty
        A-&gt;&gt;A: Store genome + fitness
    else Cell occupied
        alt New fitness &gt; stored fitness
            A-&gt;&gt;A: Replace with new
        else
            A-&gt;&gt;A: Discard new
        end
    end
    S-&gt;&gt;A: Request random elite
    A-&gt;&gt;S: Return genome for mutation</code></pre>
<h2 id="data-flow-summary">Data Flow Summary<a class="headerlink" href="#data-flow-summary" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>flowchart TB
    subgraph "Genotype"
        CPPN_G[CPPN Genome]
        NN_G[Neural Weights]
    end

    subgraph "Phenotype"
        Body[Physical Body]
        Brain[Neural Controller]
    end

    subgraph "Behavior"
        Actions[Motor Commands]
        Interact[World Interactions]
    end

    subgraph "Evaluation"
        Metrics[Performance Metrics]
        BC[Behavior Characterization]
        Fit[Fitness Score]
    end

    subgraph "Selection"
        Archive[MAP-Elites Archive]
        Mutation[Mutation Operators]
    end

    CPPN_G --&gt; Body
    NN_G --&gt; Brain
    Body --&gt; Actions
    Brain --&gt; Actions
    Actions --&gt; Interact
    Interact --&gt; Metrics
    Metrics --&gt; BC
    Metrics --&gt; Fit
    BC --&gt; Archive
    Fit --&gt; Archive
    Archive --&gt; Mutation
    Mutation --&gt; CPPN_G
    Mutation --&gt; NN_G</code></pre>
<h2 id="user-interface">User Interface<a class="headerlink" href="#user-interface" title="Permanent link">&para;</a></h2>
<p>Sunaba's UI is built with egui, providing immediate-mode rendering for game controls and information displays.</p>
<h3 id="inventory-system">Inventory System<a class="headerlink" href="#inventory-system" title="Permanent link">&para;</a></h3>
<p><img alt="Inventory Panel" src="..//sunaba/screenshots/ui_inventory.png" /></p>
<p>The inventory system supports:
- <strong>Item Stacking</strong>: Materials stack up to 999 per slot
- <strong>Tool Durability</strong>: Tools show remaining uses and degrade with use
- <strong>Quick Access</strong>: Hotbar for frequently used items
- <strong>Visual Feedback</strong>: Item icons with quantity displays</p>
<h3 id="crafting-system">Crafting System<a class="headerlink" href="#crafting-system" title="Permanent link">&para;</a></h3>
<p><img alt="Crafting Panel" src="..//sunaba/screenshots/ui_crafting.png" /></p>
<p>The crafting interface provides:
- <strong>Recipe Discovery</strong>: Available recipes shown based on inventory
- <strong>Material Requirements</strong>: Clear display of required ingredients
- <strong>Output Preview</strong>: Shows crafted item before creation
- <strong>Batch Crafting</strong>: Support for creating multiple items at once</p>
<h3 id="material-showcase">Material Showcase<a class="headerlink" href="#material-showcase" title="Permanent link">&para;</a></h3>
<p><img alt="Material Catalog" src="..//sunaba/screenshots/level_3.png" />
<em>Basic material showcase: 8 fundamental materials with distinct visual properties</em></p>
<p><img alt="Extended Materials" src="..//sunaba/screenshots/level_17.png" />
<em>Phase 5 materials: 30+ materials including ores, organics, refined materials, and special compounds</em></p>
<h3 id="lighting-world-systems">Lighting &amp; World Systems<a class="headerlink" href="#lighting-world-systems" title="Permanent link">&para;</a></h3>
<p><img alt="Day/Night Cycle" src="..//sunaba/screenshots/level_20.png" />
<em>Light propagation demonstration: underground lava, fire sources, and surface daylight</em></p>
<h3 id="structural-complexity">Structural Complexity<a class="headerlink" href="#structural-complexity" title="Permanent link">&para;</a></h3>
<p><img alt="Castle Structure" src="..//sunaba/screenshots/level_12.png" />
<em>Complex architectural structures demonstrating building capabilities</em></p>
<p><img alt="Survival Environment" src="..//sunaba/screenshots/level_16.png" />
<em>Tutorial level with resource distribution and starter area</em></p>
<h2 id="tech-stack-summary">Tech Stack Summary<a class="headerlink" href="#tech-stack-summary" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Component</th>
<th>Technology</th>
</tr>
</thead>
<tbody>
<tr>
<td>Language</td>
<td>Rust</td>
</tr>
<tr>
<td>Graphics</td>
<td>wgpu</td>
</tr>
<tr>
<td>UI</td>
<td>egui</td>
</tr>
<tr>
<td>Windowing</td>
<td>winit</td>
</tr>
<tr>
<td>Physics</td>
<td>rapier2d</td>
</tr>
<tr>
<td>Math</td>
<td>glam</td>
</tr>
<tr>
<td>Serialization</td>
<td>serde + bincode</td>
</tr>
<tr>
<td>Compression</td>
<td>lz4_flex</td>
</tr>
<tr>
<td>RNG</td>
<td>rand + rand_xoshiro</td>
</tr>
<tr>
<td>Graphs</td>
<td>petgraph</td>
</tr>
</tbody>
</table>














                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://zensical.org/" target="_blank" rel="noopener">
      Zensical
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      
      <script id="__config" type="application/json">{"annotate":null,"base":"..","features":[],"search":"../assets/javascripts/workers/search.e2d2d235.min.js","tags":null,"translations":{"clipboard.copied":"Copied to clipboard","clipboard.copy":"Copy to clipboard","search.result.more.one":"1 more on this page","search.result.more.other":"# more on this page","search.result.none":"No matching documents","search.result.one":"1 matching document","search.result.other":"# matching documents","search.result.placeholder":"Type to start searching","search.result.term.missing":"Missing","select.version":"Select version"},"version":null}</script>
    
    
      <script src="../assets/javascripts/bundle.00c35305.min.js"></script>
      
    
  </body>
</html>